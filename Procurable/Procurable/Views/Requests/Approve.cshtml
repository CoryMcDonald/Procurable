@model IEnumerable<Procurable.Models.Request>


@if (User.IsInRole("Admin")){
    <h2>All Requests</h2>
}
else{
    <h2>Pending Requests</h2>
}


@using (Html.BeginForm())
{

    <table class="table-hover table">
        <tr>
            <th>
                @Html.DisplayNameFor(model => model.ID)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Name)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Comments)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.RequestedFor)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Status)
            </th>
       
            <th></th>
        </tr>

    @foreach (var item in Model)
    {   if (User.IsInRole("Admin") || item.Status == Procurable.Models.RequestStatus.Opened || item.Status == Procurable.Models.RequestStatus.Reopened)
        {
        <tr >
            <td data-toggle="modal" data-target="#@item.ID" class="RequestID">
                @Html.DisplayFor(modelItem => item.ID)
            </td>
            <td data-toggle="modal" data-target="#@item.ID" class="">
                @Html.DisplayFor(modelItem => item.Name)
            </td>
            <td data-toggle="modal" data-target="#@item.ID" class="">
                @Html.DisplayFor(modelItem => item.Comments)
            </td>
            <td data-toggle="modal" data-target="#@item.ID" class="">
                @Html.DisplayFor(modelItem => item.RequestedFor)
            </td>
            <td data-toggle="modal" data-target="#@item.ID" class="">
                @Html.DisplayFor(modelItem => item.Status)           
            </td>
       
            <td style="padding: 5px;">
                <div class="form-group-sm">
                    @Html.DropDownListFor(modelItem => item.Status, new SelectList(Enum.GetValues(typeof(Procurable.Models.RequestStatus)), item.Status), new { @class = "form-control RequestStatus" })
                    
                </div>

            </td>
            <td>
                <!-- Modal -->
                <div id="@item.ID" class="modal" role="dialog">
                    <div class="modal-dialog">

                        <!-- Modal content-->
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                                <h4 class="modal-title">@Html.DisplayFor(modelItem => item.ID) - @Html.DisplayFor(modelItem => item.Name)</h4>
                            </div>
                            <div class="modal-body">
                                <div class="row">
                                    <div class="col-md-12">Created: @Html.DisplayFor(modelItem => item.CreatedDate)</div>
                                    <div class="col-md-12">Modified: @Html.DisplayFor(modelItem => item.LastModified)</div>
                                    <div class="col-md-12">Requested By: @Html.DisplayFor(modelItem => item.RequestedBy)</div>
                                    
                                </div>
                                <hr />
                                <div class="row">
                                    @Html.DisplayFor(modelItem => item.Items)
                                </div>

                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                            </div>
                        </div>

                    </div>
                </div>
            </td>
           
        </tr>
       

        }
    }

    </table>

    

    @Html.Hidden("RequestStatusList")

    <p>
        <input type="submit" value="Submit" class="btn btn-default"  formaction='@Url.Action("BatchUpdateStatus")'/>
             
    </p>
    <hr class="darkLine"/>
}

<script>
    $(document).ready(function () {
       
    });

    $(".RequestStatus").change(function () {
        var statusList = [];

        $(".RequestStatus").each( function () {
            var row = $(this).parent('div').parent('td').parent('tr');
            var id = row.find('.RequestID').html().trim();
            console.log(id);
            var status = {
                id: id,
                status: $(this).val()
            }
           statusList.push(status)
        });
       
        console.log(statusList);

        $("#RequestStatusList").val(JSON.stringify(statusList));
       
    });

</script>
